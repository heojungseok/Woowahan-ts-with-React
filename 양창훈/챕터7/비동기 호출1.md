# API ìš”ì²­

## fetchë¡œ API ìš”ì²­í•˜ê¸°

```ts
const CartBadge:React.FC = () => {
  const [cartCount,setCartCount] = useState(0);

  useEffect(()=>{
    fetch("https://api.baemin.com/cart").then(({cartItem})=>{
      setCartCount(cartItem.length);
    })
  },[]);
  // cartCount ìƒíƒœë¥¼ ì´ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
}
```
ìœ„ í•¨ìˆ˜ëŠ” ì¥ë°”êµ¬ë‹ˆ ì •ë³´ë¥¼ ë¹„ë™ê¸° í•¨ìˆ˜ì¸ fetchë¡œ ë¶ˆëŸ¬ì™€ ì¥ë°”êµ¬ë‹ˆ ë‚´ë¶€ë¥¼ í™•ì¸í•˜ì—¬ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´
ë¬¼í’ˆì˜ ê°œìˆ˜ë¥¼ ë°°ì§€ ì•„ì´ì½˜ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥

ë°±ì—”ë“œì—ì„œ ê¸°ëŠ¥ ë³€ê²½ì„ í•´ì•¼ í•´ì„œ API URLì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤ê³  í• ë•Œ. ì´ë¯¸ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ê¹Šìˆ™ì´
ìë¦¬ ì¡ì€ ë¹„ë™ê¸° í˜¸ì¶œ ì½”ë“œëŠ” ì´ëŸ¬í•œ ë³€ê²½ ìš”êµ¬ì— ì·¨ì•½í•˜ë‹¤.

URL ë³€ê²½ë¿ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ì„œë²„ì— APIë¥¼ ìš”ì²­í•  ë•Œ íƒ€ì„ì•„ì›ƒ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.
ë˜ëŠ” ëª¨ë“  ìš”ì²­ì— ì»¤ìŠ¤í…€ í—¤ë”ê°€ í•„ìš”í•˜ë‹¤ ê°•íŠ¼ ìƒˆë¡œìš´ API ìš”ì²­ ì •ì±…ì´ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ê³„ì†í•´ì„œ ë¹„ë™ê¸° í˜¸ì¶œ ì½”ë“œë¥¼
ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ë°œìƒí•œë‹¤.

## ì„œë¹„ìŠ¤ ë ˆì´ì–´ë¡œ ë¶„ë¦¬í•˜ê¸°

ì—¬ëŸ¬ API ìš”ì²­ ì •ì±…ì´ ì¶”ê°€ë˜ì–´ ì½”ë“œê°€ ë³€ê²½ë  ìˆ˜ ì‡ë‹¤ëŠ” ê²ƒì„ ê°ì•ˆí•œë‹¤ë©´ ë¹„ë™ê¸° í˜¸ì¶œ ì½”ë“œëŠ” ì»´í¬ë„ŒíŠ¸ ì˜ì—­ì—ì„œ
ë¶„ë¦¬ë˜ì–´ ë‹¤ë¥¸ì˜ì—­(ì„œë¹„ìŠ¤ ë ˆì´ì–´)ì—ì„œ ì²˜ë¦¬ë˜ì–´ì•¼ í•œë‹¤.


## axios

fetch í•¨ìˆ˜ ëŒ€ì‹  Axios ë¼ì´ë¸ŒëŸ¬ë¦¬ ì“°ëŠ” ì´ìœ ? ì¬ì‚¬ìš©ì„± ì—…!

ê°ì„œë²„ê°€ ë‹´ë‹¹í•˜ëŠ” ë¶€ë¶„ì´ ë‹¤ë¥´ê±°ë‚˜ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì˜ ì¼ë¶€ë¡œ í¬í•¨ë  ë•Œ ê¸°ì¡´ì— ì‚¬ìš©í•˜ëŠ” API Entry(Base URL)ê³¼ëŠ” ë‹¤ë¥¸ ìƒˆë¡œìš´ URLë¡œ ìš”ì²­í•´ì•¼í•˜ëŠ” ìƒí™©
API Entryê°€ 2ê°œ ì´ìƒì¼ ê²½ìš°ì—ëŠ” ê° ì„œë²„ì˜ ê¸°ë³¸ URL ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë”°ë¡œ êµ¬ì„±í•´ì•¼í•˜ë‚Ÿ.
ì´í›„ ë‹¤ë¥¸ URLë¡œ ì„œë¹„ìŠ¤ ì½”ë“œë¥¼ í˜¸ì¶œí•  ë•ŒëŠ” ê°ê°ì˜ apiRequestë¥¼ ì‚¬ìš©í•˜ë©´ëœë‹¤

??

ê± ë˜‘ê°™ì´ fetch ë‘ë²ˆ ì“°ë©´ ë˜ëŠ”ê±° ì•„ë‹Œê°€ ?

```ts
// api/main.js
export const mainApi = axios.create({
  baseURL: "https://api.main.com",
  timeout: 5000,
});

// api/auth.js
export const authApi = axios.create({
  baseURL: "https://api.auth.com",
  timeout: 5000,
});
```

```ts
import { mainApi } from "./api/main";
import { authApi } from "./api/auth";

mainApi.get("/users");
authApi.post("/login", { id, pw });
```

## axios ì¸í„°ì…‰í„° ì‚¬ìš©í•˜ê¸°

Axios ì¸í„°ì…‰í„°(interceptor) ëŠ”
â€œìš”ì²­(Request) ë˜ëŠ” ì‘ë‹µ(Response)ì´ ë„¤íŠ¸ì›Œí¬ë¡œ ì˜¤ê°€ê¸° ì „ì— ê°€ë¡œì±„ì„œ
ê³µí†µ ë¡œì§ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê¸°ëŠ¥â€ì…ë‹ˆë‹¤.

requestë³„ë¡œ ì„œë¡œ ë‹¤ë¥¸ í—¤ë”ë¥¼ ì„¤ì •í•´ì¤˜ì•¼ í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ
ì¸í„°ì…‰íŠ¸ ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬

```ts
import axios from "axios";

const api = axios.create({
  baseURL: "https://api.example.com",
});


api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem("access_token");
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    console.log("ğŸ“¤ ìš”ì²­ ì „:", config.url);
    return config;
  },
  (error) => {
    // ìš”ì²­ì´ ë³´ë‚´ì§€ê¸° ì „ì— ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°
    return Promise.reject(error);
  }
);
```

ì´ì œ api.get("/users") í•˜ë©´ Axiosê°€ ìë™ìœ¼ë¡œ 
í—¤ë”ì— Authorization: Bearer <token> ì„ ë¶™ì—¬ì„œ ìš”ì²­ì„ ë³´ëƒ„.

**ë¹Œë” íŒ¨í„´**
> ê°ì²´ ìƒì„±ì„ ë” í¸ë¦¬í•˜ê³  ê°€ë…ì„± ìˆê²Œ ë§Œë“¤ê¸° ìœ„í•œ ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜ë‹¤.  
> ì£¼ë¡œ ë³µì¡í•œ ê°ì²´ì˜ ìƒì„±ì„ ë‹¨ìˆœí™”í•˜ê³ , ê°ì²´ ìƒì„± ê³¼ì •ì„ ë¶„ë¦¬í•˜ì—¬ ê°ì²´ë¥¼ ì¡°ë¦½í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.

## API ì‘ë‹µ íƒ€ì… ì§€ì •í•˜ê¸°
ê°™ì€ ì„œë²„ì—ì„œ ì˜¤ëŠ” ì‘ë‹µì˜ í˜•íƒœëŠ” ëŒ€ì²´ë¡œ í†µì¼ë˜ì–´ ìˆë‹¤? ê·¸ëŸ°ê°€
ì–´ì¨‹ë“  ê·¸ë ‡ë‹¤ê³  ìƒê°€ê°›ê³  APIì˜ ì‘ë‹µê°’ì„ í•˜ë‚˜ì˜ Response íƒ€ì…ìœ¼ë¡œ ë¬¶ìœ¼ë©´

```ts
interface Response<T> {
  data: T;
  status: string;
  serverDateTime: string;
  errorCode?: string;
  errorMessage?: string;
}

const fetchCart = (): AxiosPromise<Response<FetchCartResponse>> => {
  apiRequester.get < Response < FetchCartResponse >> 'cart';
};

const postCart = (
  postCartRequest: PostCartRequest
): AxiosPromise<Response<PostCartResponse>> => {
  apiRequester.post<Response<PostCartResponse>>('cart', postCartRequest);
};
```

ìœ„ì²˜ëŸ¼

ê·¼ë° ì£¼ì˜í•  ê²ŒìˆëŠ”ë°
Responseíƒ€ì…ì„ apiRequestë‚´ì—ì„œ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ ìƒê°ì´ ë“¤ ìˆ˜ ìˆëŠ”ë° ê·¸ë ‡ê²Œí•˜ë©´ ì—…ë°ì´íŠ¸ë‚˜ CREATEê°™ì´ ì‘ë‹µì´ ì—†ì„ ë•Œì˜ ê²½ìš° APIë¥¼ ì²˜ë¦¬í•˜ê¸° ì–´ë ¤ì›Œì§„ë‹¤

ê·¸ë˜ì„œ

```ts
const updateCart = (
  updateCartRequest
): AxiosPromise<Response<FetchCartResponse>> => apiRequester.get<null>('cart');
```

ë”°ë¼ì„œ Response íƒ€ì…ì€ apiRequesterê°€ ëª¨ë¥´ê²Œ ê´€ë¦¬ë˜ì–´ì•¼ í•œë‹¤.

## ë·° ëª¨ë¸ ì‚¬ìš©í•˜ê¸°

ë°±ì—”ë“œì—ì„œ APIì˜ ì‘ë‹µê°’ì´ ë°”ë€” ìˆ˜ ìˆë‹¤ ì´ˆê¸°ì—ëŠ”
```ts
{
  "jobItems": [
    { "name": "ê°œë°œì" },
    { "name": "ë””ìì´ë„ˆ" }
  ]
}
```
ê°€
```ts
{
  "results": [
    { "title": "ê°œë°œì" },
    { "title": "ë””ìì´ë„ˆ" }
  ]
}
```

ì´ë•Œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì‘ë‹µê°’ë“¤ë„ ì¼ì¼ì´ ë°”ê¿”ì¤˜ì•¼í•˜ê³  ë²ˆê±°ë¡­ë‹¤

ë·° ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì‘ë‹µ ì›ë³¸ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ 
ê³µí†µëœ í˜•íƒœë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ì

```ts
nterface JobListItemResponse {
  name: string;
}

interface JobListResponse {
  jobItems: JobListItemResponse[];
}

class JobList {
  readonly totalItemCount: number;
  readonly items: JobListItemResponse[];

  constructor({ jobItems }: JobListResponse) {
    this.totalItemCount = jobiItems.length;
    this.items = jouItems;
  }
}

const fetchJobList = async (
  filter?: ListFetchFilter
): Promise<JobListResponse> => {
  const { data } = await api
    .params({ ...filter })
    .get('/apis/get-list-summaries')
    .call<Response<JobListResponse>>();

  return new JobList(data);
};
```

ìŒ ë­”ë§ì¸ì§€ëŠ” ì•Œ ê²ƒ ê°™ì€ë° ìœ„ ì½”ë“œëŠ” ì˜ëª¨ë¥´ê² ë”°


# API ìƒíƒœ ê´€ë¦¬í•˜ê¸°
ì‹¤ì œ APIë¥¼ ìš”ì²­í•˜ëŠ” ì½”ë“œëŠ” ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•ˆí”ë‹¤.

ë¹„ë™ê¸° APIë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” APIì˜ ì„±ê³µ ì‹¤íŒ¨ì— ë”°ë¥¸ ìƒíƒœê°€ ê´€ë¦¬ ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì•¡ì…˜ì´ë‚˜ í›…ê³¼ ê°™ì´ ì¬ì •ì˜ëœ í˜•íƒœë¥¼ ì¬ì‚¬ìš©í•´ì•¼í•œë‹¤

## ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ í˜¸ì¶œí•˜ê¸°

ê·¸ëŸ° ë¹„ë™ê¸° í•¨ìˆ˜ë“¤ì€ ì„œë¹„ìŠ¤ ì½”ë“œë¥¼ ì‚¬ìš©í•´ì„œ ë¹„ë™ê¸° ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¬ ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤.

ì»´í¬ë„ŒíŠ¸ëŠ” ìœ„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ êµ¬ë…í•˜ê³ ,
ìƒíƒœê°€ ë³€ê²½ë  ë•Œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤




```ts

// ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ì‘ë‹µ ê°’ì„ JobList ë·°ëª¨ë¸ì— ë„£ì–´ ë°˜í™˜ ê°’ì„ ì¼ì •í•˜ê²Œ ë§Œë“ ë‹¤?
const useFetchJobList = () => {
  return useQuery(['fetchJobList'], async () => {
    const response = await JobService.fetchJobList();

    return new JobList(response);
  });
};

//
const useUpdateJob = (
  id: number,
  { onSucess, ...options }: UseMutationOptions<void, Error, JobUpdateFormValue>
): UseMutationResult<void, Error, JobUpdateFormValue> => {
  const queryClient = useQueryClient();

  // ["update", id] í‚¤ë¥¼ ê°€ì§„ ìºì‹œ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ ì—…ë°ì´íŠ¸ ëœ ë°ì´í„°ë¥¼ ê´€ë¦¬
  return useMutation(
    ['update', id],
    async (jobUpdateForm: JobUpdateFormValue) => {
      //JobService.updateJobë¥¼ í˜¸ì¶œí•˜ì—¬ ì„œë²„ì— ì—…ë°ì´íŠ¸ë¥¼ ìš”ì²­
      await JobService.updateJob(id, jobUpdateForm);
    },
    {
      onSuccess: (data: void, values: JobUpdateFormValue, context: unknown) => {
        // "fetchJobList" ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”ì‹œì¼œ ì¬ì¡°íšŒë¥¼ ìœ ë„
        queryClient.invalidateQueries(['fetchJobList']);

        onSuccess && onSuccess(data, values, context);
      },
      ...options,
    }
  );
};
```



ì¦‰ê°ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ” ë¡œë”©, ì—ëŸ¬, ì„±ê³µ ìƒíƒœ ê°™ì€ ì„œë²„ ë°ì´í„° ê´€ë ¨ ìƒíƒœëŠ”
ì „ì—­ ìƒíƒœê´€ë¦¬(Redux, Recoil ë“±)ë¡œ ê´€ë¦¬í•˜ê¸°ë³´ë‹¤ React Queryë¡œ ê´€ë¦¬í•˜ëŠ” ê²Œ ë‚«ë‹¤.

ì–´ì¨‹ë“  ìœ„ì²˜ëŸ¼ APIì˜ ì„±ê³µ ì‹¤íŒ¨ì— ë”°ë¥¸ ìƒíƒœê´€ë¦¬(ì—¬ëŸ¬ APIë¥¼ í˜¸ì¶œí•  ê²½ìš°)
ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ë¥¼ í†µí•œ ì¬ì •ì˜ëœ í˜•íƒœë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤
