# 자바스크립트의 런타임과 타입스크립트의 컴파일

## 런타임과 컴파일타임

컴파일: 소스코드를 기계어코드로 변환하여 실행이 가능한 프로그램이 되게끔하는 과정
런타임: 소스코드의 컴파일 후 응용 프로그램이 사용자에 의해 실행되는 과정

## 자바스크립트 런타임

자바스크립트의 런타임은 자바스크립트가 실행되는 환경을 의미함
크롬, 사파리같은 브라우저나 Node.js등이 있다.

런타임의 구성요소로는 자바스크립트 엔진, 웹 API, 콜백 큐, 이벤트 루프, 렌더 큐가 있다.



## 타입스크립트의 컴파일
일반적인 컴파일은 고수준언어에서 저수준 언어로 변환되느 과정을 가리킨다.
근데 타입스크립트는 고수준 언어(ts)가 또 다른 고수준 언어(js)로 변환되는 것이기 때문ㅇ[
타입스크립트는 tsc라고 불리는 컴파일러르 통해 자바스크립트 코드로 변환된다.



# 타입스크립트 컴파일러의 동작

##  코드 검사기로서의 타입스크립트 컴파일러
타입스크립트 컴파일러는 코드에 타입 오류가 없는지를 확인한다.


```js
const developer = {
  work() {
    console.log("working...")
  }
}
developer.work();
developer.sleep();
```
해당 코드를 자바스크립트로 작성시 바로 에러가 발생하지 않고 실제 실행을 해야 에러가 발생한다.


```ts
const developer = {
  work() {
    console.log("working...")
  }
}
developer.work();
developer.sleep(); // Property ...
```
같은 코드를 타입스크립트로 작성하면 실행전에 에러를 사전에 알려준다.


## 코드 변환기로서의 타입스크립트 컴파일러

런타임 환경에서 동작할 수 있도록 자바스크립트로 트랜스파일하는 것이 타입스크립트 컴파일러의 두번째 역할이다.

```ts
type Fruit = "banana" | "watermelon" | "orange" | "apple" | "kiwi" | "mango";

const fruitBox: Fruit[] = ["banana", "apple", "mango"];

const welcome = (name: string) => {
  console.log(`hi! ${name} :)`);
};
```
위 코드를 컴파일러의 target 옵션을 사용하면 특정 버전의 js소스코드로 컴파일할 수 있따.

```ts
"use strict";

var fruitBox = ["banana", "apple", "mango"];

var welcome = function (name) {
  console.log("hi! ".concat(name, " :)"));
};
```

위와 같이 런타임 실행이 가능한 소스코드로 변환된 것을 볼 수 있따.

이때 타입에러가 존재한 코드를 컴파일해도 자바스크립트 소스코드로 변환이 된다고 한다.

```ts
let age: number = "20"; // ❌ 타입 오류
```
tsc로 컴파일 후
```ts
var age = "20";
```
타입 에러 시 js 생성 방지 방법으로는 아래처럼 tsconfig.json에 옵션을 추가하면 된다고한다.
```ts
{
  "compilerOptions": {
    "noEmitOnError": true
  }
}
```


# 타입스크립트 컴파일러의 구조

타입스크립트의 컴파일러는 하나의 프로그램으로 이를 구현한 소스 파일이 존재한다.
아래는 컴파일러가 동작하는데 중요한 몇가지 구성 요소이다.


<img width="673" height="141" alt="image" src="https://github.com/user-attachments/assets/061e7e37-5ce3-4c43-9325-7e3fb70e277b" />
타입스크립트 컴파일러의 실행 과정


## 프로그램
ts 컴파일러는 tsc 명령어로 실행되며 tsconfig.json에 명시된 옵션을 기반으로 컴파일을 수행한다.



## 스캐너

ts 소스 파일을 어휘적으로 분석하여 토큰을 생성하는 역할을 함
```ts
const woowa = "bors";
```
위 변수의코드는 아래와 같이 분석된다


<img width="518" height="143" alt="image" src="https://github.com/user-attachments/assets/7327a21e-93e6-4f31-b097-0dc85b78e279" />

| 구분 | 토큰 이름 | 예시 코드 조각 
|------|------------|---------------
| **ConstKeyword** | `const` | 예약어(키워드). 변수 선언 시 사용됨 |
| **WhitespaceTrivia** | 공백 (` `) | 코드 의미에는 영향 없지만, 토큰을 구분하는 역할 |
| **Identifier** | `woowa` | 변수 이름(식별자) |
| **EqualsToken** | `=` | 대입 연산자 토큰 |
| **StringLiteral** | `'bros'` | 문자열 리터럴 (문자열 데이터) |
| **SemicolonToken** | `;` | 문장 종료 토큰 |


## 파서

파서는 스캐너로 만들어진 토큰 정보를 이용하여 AST를 생성한다.
AST는 컴파일러가 동작하는데 핵심 기반이 되는 자료 구조로, 소스코드의 구조를 트리형태로 표현한다.

```ts
function normalFunction() {
  console.log("normalFunction");
}
```

<img width="682" height="396" alt="image" src="https://github.com/user-attachments/assets/e699d595-ece9-4604-8ab8-cbbc82f6ff60" />


스캐너(단위로 쪼개고) -> 합치기


## 바인더

바인더의 주요 역할은 체커 단계에서 타입 검사를 할 수 있도록 기반을 마련하는 것이다.

타입 검사를 위해 심볼이라는 데이터 구조를 생성한다.
심볼은 AST에서 선언된 타입의 노드 정보를 저장한다.

```ts
type Sometype = string | number;
```
<img width="322" height="258" alt="image" src="https://github.com/user-attachments/assets/2ea3b3a6-5335-4486-9353-cf3d3b3a504b" />



## 체커와 이미터

체커는 파서가 생성한 AST와 바인더가 생성한 심볼을 활용하여 타입 검사를 수행한다.


이미터는 타입스크립트 소스 파일을 변환하는 역할을 하여 타입스크립트 소스를 자바스크립트파일과 타입 선언 파일로 생성한다.




컴파일 -> 토큰 단위 분리 -> AST 생성 -> AST의 각 노드에 대응하는 심볼 생성 -> AST를 탐색하며 심볼 정보를 활용하여 타입검사 -> 타입 에러없다면 js 소스파일로 변환 



이미지 출처: "우아한 타입스크립트 with 리액트", 우아한형제들, 한빛미디어
